<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pta na</title>
    <style>
        * {
            margin: 0;
        }

        #canvas {
            background-color: black;
        }
    </style>
</head>

<body>
    <input type="text" id="inp">
    <span>
        <input type="range" name="" id="xA" value="10">
        <label for="xA">X-axis</label>
        <input type="range" name="" id="yA" value="10">
        <label for="yA">Y-axis</label>
        <button id="button">Resettel</button>
    </span>
    <canvas id="canvas"></canvas>
</body>
<script type="module">
    import Vector from './vector.js'
    import Ball from './ball.js'
    import { Graph } from './graph.js'
    const c = document.getElementById('canvas');
    let W = c.width = window.innerWidth;
    let H = c.height = window.innerHeight;
    const ctx = c.getContext('2d');
    let Balls = [];
    let g = new Graph(ctx);
    let [x, y] = [10, 10];
    const xA = document.getElementById('xA');
    const yA = document.getElementById('yA');
    const b = document.getElementById('button');
    let funs = Object.getOwnPropertyNames(Math)
    let value = () => {
        let v = Y.value.toLowerCase()
        funs.forEach(fun => v = v.replace(fun, 'Math.' + fun))
        console.log(v);
        return v
    }
    b.addEventListener('click', () => {
        Y.oninput()
    })
    let Y = document.getElementById('inp');
    [xA, yA].forEach(e => {
        e.addEventListener('input', () => {
            [x, y] = [xA.value, yA.value]
        })
    })
    g.drawGrid(ctx, x, y)
    for (let i = 0; i < W; i++) {
        let b = Ball.randomBall(ctx, 'white')
        b.r = 2
        b.acc = new Vector()
        Balls.push(b)
        Ball.resist = 1.05
        b.draw(ctx)
    }
    Y.oninput = () => {
        let p = Graph.getPoints(ctx, value(), x, y)
        for (let i = 0; i < Ball.count; i++) {
            p[i][2] == 'error' ? Balls[i].color = 'red' : Balls[i].color = 'lightgreen'
            Balls[i].goto = new Vector(p[i][0], p[i][1])
        }
    }
    function animate() {
        ctx.clearRect(0, 0, W, H);
        g.drawGrid(ctx, x, y)
        g.drawAxis(ctx, x, y)
        Balls.forEach(b => {
            b.draw(ctx)
        });
        setTimeout(() => {
            window.requestAnimationFrame(animate);
        }, 20);
    }
    window.requestAnimationFrame(animate);
</script>

</html>